<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BAND2BINKS</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .hidden { display: none; }
        .toast {
            animation: slide-in 0.5s ease forwards, fade-out 0.5s ease forwards 3s;
        }
        @keyframes slide-in {
            0% { transform: translateX(100%); opacity: 0; }
            100% { transform: translateX(0); opacity: 1; }
        }
        @keyframes fade-out {
            0% { opacity: 1; }
            100% { opacity: 0; }
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

<div class="container mx-auto py-8">
    <!-- Titre -->
    <h1 class="text-4xl font-bold text-center mb-6">BAND2BINKS</h1>

    <!-- Formulaire -->
    <form method="post" class="flex justify-center mb-8">
        <input type="text" name="url" placeholder="Entrez l'URL Bandcamp"
               class="w-3/4 p-3 border rounded-l-lg focus:outline-none">
        <button type="submit" class="bg-blue-500 text-white px-6 rounded-r-lg hover:bg-blue-600">
            Télécharger
        </button>
    </form>

    <!-- Notifications Toast -->
    <div id="toast" class="fixed top-4 right-4 bg-green-500 text-white px-4 py-2 rounded-lg shadow-lg hidden"></div>

    <!-- Barre de Progression -->
    <div id="progress-container" class="hidden mb-4">
        <h3 class="text-center font-medium mb-2">Progression du téléchargement</h3>
        <div class="w-full bg-gray-300 rounded-lg overflow-hidden">
            <div id="progress-bar" class="h-3 bg-blue-500 transition-all duration-500" style="width: 0%;"></div>
        </div>
    </div>

    <!-- Liste des Dossiers -->
    <div id="folders">
        {% for folder, files in folders.items() %}
        <div class="bg-white rounded-lg shadow-lg mb-6">
            <div class="flex items-center p-4">
                <span class="cursor-pointer text-blue-500 mr-2" onclick="toggleFolder('{{ folder }}')">▼</span>
                <img src="/static/downloads/{{ folder }}/cover.jpg" alt="cover"
                     class="w-12 h-12 rounded-lg mr-4" onerror="this.src='/static/folder.png'">
                <strong class="text-lg">{{ folder }}</strong>
                <a href="{{ url_for('download_zip', folder=folder) }}"
                   class="ml-auto text-sm bg-green-500 text-white px-4 py-1 rounded hover:bg-green-600">Télécharger tout</a>
            </div>
            <div id="{{ folder }}" class="hidden px-4 pb-4">
                <ul class="space-y-2">
                    {% for file in files %}
                    {% if file.endswith('.mp3') %}
                    <li class="flex justify-between items-center p-2 bg-gray-50 rounded">
                        <span>{{ file }}</span>
                        <!-- Player Audio -->
                        <audio controls class="w-1/2">
                            <source src="{{ url_for('download_file', folder=folder, filename=file) }}" type="audio/mp3">
                            Votre navigateur ne supporte pas l'audio.
                        </audio>
                    </li>
                    {% endif %}
                    {% endfor %}
                </ul>
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- Pagination Bouton -->
    <div id="pagination" class="text-center mt-8">
        <button onclick="loadMore()" class="bg-blue-500 text-white px-6 py-2 rounded hover:bg-blue-600">
            Charger plus
        </button>
    </div>
</div>

<!-- Scripts -->
<script>
    // Toggle Animation
    function toggleFolder(folderId) {
        const folderContent = document.getElementById(folderId);
        folderContent.classList.toggle('hidden');
    }

    // Notifications Toast
    function showToast(message) {
        const toast = document.getElementById('toast');
        toast.textContent = message;
        toast.classList.remove('hidden');
        setTimeout(() => toast.classList.add('hidden'), 3500);
    }

    // Progression de Téléchargement
    function updateProgress() {
        const progressBar = document.getElementById('progress-bar');
        const progressContainer = document.getElementById('progress-container');
        progressContainer.classList.remove('hidden');
        let width = 0;
        const interval = setInterval(() => {
            width += 20;
            progressBar.style.width = width + '%';
            if (width >= 100) clearInterval(interval);
        }, 500);
    }

    // Simuler Progression et Toast après soumission du formulaire
    document.querySelector("form").addEventListener("submit", (e) => {
        showToast("Téléchargement en cours...");
        updateProgress();
    });

    // Pagination - Simuler le Scroll Infini
    function loadMore() {
        const newContent = `
        <div class="bg-white rounded-lg shadow-lg mb-6 p-4">
            <p class="text-center text-gray-500">Contenu supplémentaire chargé...</p>
        </div>`;
        document.getElementById('folders').insertAdjacentHTML('beforeend', newContent);
    }
</script>
</body>
</html>
